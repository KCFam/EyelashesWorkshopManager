<div class="container">
  <form [formGroup]="staffTransactionFormGroup" (ngSubmit)="onSubmit()">
    <!--Search Staff-->
    <div class="row">
      <div class="col-md-6">
        <mat-form-field style="width:100%">
          <mat-label class="search-staff"
            ><mat-icon matSuffix>search</mat-icon>Tìm nhân viên</mat-label
          >
          <input
            type="text"
            matInput
            formControlName="searchStaff"
            [matAutocomplete]="auto"
            required
          />
          <mat-autocomplete
            autoActiveFirstOption
            #auto="matAutocomplete"
            [displayWith]="staffSearchDisplayFn"
          >
            <mat-option
              *ngFor="let staffOption of staffRefOptions | async"
              [value]="staffOption"
            >
              <div>
                <div style="display:inline-block;width:30%">
                  <mat-icon>phone_iphone</mat-icon>{{ staffOption["phone"] }}
                </div>
                <mat-icon>face</mat-icon>{{ staffOption["name"] }}
                <span></span>
              </div>
            </mat-option>
          </mat-autocomplete>
          <button
            mat-button
            *ngIf="staffTransactionFormGroup.controls['searchStaff'].value"
            matSuffix
            mat-icon-button
            aria-label="Clear"
            (click)="
              staffTransactionFormGroup.controls['searchStaff'].setValue('')
            "
          >
            <mat-icon>close</mat-icon>
          </button>
        </mat-form-field>
      </div>
    </div>
    <!--Add Products actions-->
    <div class="row">
      <div class="col-4 pr-0">
        <mat-form-field class="w-100">
          <mat-label>Loại khuôn</mat-label>
          <mat-select formControlName="lashTool" required>
            <mat-option *ngFor="let lashTool of lashTools" [value]="lashTool">
              {{ lashTool }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col-3 pr-0">
        <mat-form-field class="w-100">
          <mat-label>Tóc</mat-label>
          <mat-select formControlName="hairType" required>
            <mat-option *ngFor="let hairType of hairTypes" [value]="hairType">
              {{ hairType }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col-3 pr-0">
        <mat-form-field class="w-100">
          <mat-label>Số dây</mat-label>
          <input matInput formControlName="quantity" type="number" required />
        </mat-form-field>
      </div>
      <div class="col-1 pr-0">
        <button type="button" mat-mini-fab>
          <mat-icon>add</mat-icon>
        </button>
      </div>
    </div>
    <!--Added transactions table-->
    <div class="row">
      <div class="col-12">
        <div class="transaction-container">
          <table
            mat-table
            [dataSource]="transactions"
            class="w-100"
            style="height:300px"
          >
            <!-- Item Name Column -->
            <ng-container matColumnDef="itemName">
              <th mat-header-cell *matHeaderCellDef>Tên</th>
              <td mat-cell *matCellDef="let transaction">
                {{ transaction.itemName }}
              </td>
              <td mat-footer-cell *matFooterCellDef>
                {{ transactions.length }}&nbsp;món
              </td>
            </ng-container>

            <!-- Quantity Column -->
            <ng-container matColumnDef="quantity">
              <th mat-header-cell *matHeaderCellDef>S.L.</th>
              <td mat-cell *matCellDef="let transaction">
                {{ transaction.quantity }}
              </td>
              <td mat-footer-cell *matFooterCellDef>
                {{ getQuantityTotal() }}
              </td>
            </ng-container>

            <!-- Price Per Item Column -->
            <ng-container matColumnDef="pricePerItem">
              <th mat-header-cell *matHeaderCellDef class="text-right">Giá</th>
              <td mat-cell *matCellDef="let transaction" class="text-right">
                {{ transaction.pricePerItem | currency: "VND":"" }}&nbsp;ngàn
              </td>
              <td mat-footer-cell *matFooterCellDef class="text-right"></td>
            </ng-container>

            <!-- Sub Total Column -->
            <ng-container matColumnDef="total">
              <th mat-header-cell *matHeaderCellDef class="text-right">Tổng</th>
              <td mat-cell *matCellDef="let transaction" class="text-right">
                {{
                  transaction.pricePerItem * transaction.quantity
                    | currency: "VND":""
                }}&nbsp;ngàn
              </td>
              <td mat-footer-cell *matFooterCellDef class="text-right">
                {{ getTotal() | currency: "VND":"" }}&nbsp;ngàn
              </td>
            </ng-container>

            <tr
              mat-header-row
              *matHeaderRowDef="displayedColumns; sticky: true"
            ></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            <tr
              mat-footer-row
              *matFooterRowDef="displayedColumns; sticky: true"
              class="font-weight-bold"
            ></tr>
          </table>
        </div>
      </div>
    </div>
    <!--Form actions-->
    <div class="row">
      <div class="col-12 text-right">
        <button mat-raised-button color="primary" class="mr-2" type="submit">
          Lưu
        </button>
        <button
          mat-raised-button
          color="warn"
          type="reset"
          (click)="onCancel()"
        >
          Hủy
        </button>
      </div>
    </div>
  </form>
</div>
